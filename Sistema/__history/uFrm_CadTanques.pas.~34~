unit uFrm_CadTanques;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, u_DFCad, DB, IBCustomDataSet, IBTable, StdCtrls, Mask, DBCtrls,
  ComCtrls, Buttons, Grids, DBGrids, DBClient;

type
  TFrm_CadTanques = class(T_DFCad)
    Label2: TLabel;
    txt_Descricao: TDBEdit;
    Label3: TLabel;
    txt_Imposto: TDBEdit;
    procedure Btn_NovoClick(Sender: TObject);
    procedure txt_DescricaoKeyDown(Sender: TObject; var Key: Word;
      Shift: TShiftState);
    procedure txt_ImpostoKeyDown(Sender: TObject; var Key: Word;
      Shift: TShiftState);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  Frm_CadTanques: TFrm_CadTanques;

implementation

uses uDM, uClasses;

{$R *.dfm}

procedure TFrm_CadTanques.Btn_NovoClick(Sender: TObject);
var
  Tanque: TTanque; Bomba: TBomba; Abastecimento: TAbastecimento;
  TanqueLista: TArray<TTanque>;
  BombaLista: TArray<TBomba>;
  AbastecimentoLista: TArray<TAbastecimento>;
  Cod1, Cod2: Integer;
begin
  //CADASTRA 1
  Tanque := TTanque.Create;
  Tanque.Descricao := 'TESTE 03';
  Tanque.Imposto := 13;
  Tanque.Salvar;
  Cod1 := Tanque.Codigo;
  FreeAndNil(Tanque);
  //CADASTRA 2
  Tanque := TTanque.Create;
  Tanque.Descricao := 'TESTE 04';
  Tanque.Imposto := 13;
  Tanque.Salvar;
  Cod2 := Tanque.Codigo;
  FreeAndNil(Tanque);
  //EDITA 2
  Tanque := TTanque.Create;
  Tanque.Abrir(Cod2);
  Tanque.Descricao := Tanque.Descricao + ' EDITADO';
  Tanque.Imposto := 13;
  Tanque.Salvar;
  Tag := Tanque.Codigo;
  FreeAndNil(Tanque);
  //DELETA 1
  Tanque := TTanque.Create;
  Tanque.Abrir(Cod1);
  Tanque.Deletar;
  FreeAndNil(Tanque);


  //CADASTRA 1
  Bomba := TBomba.Create;
  Bomba.Descricao := 'TESTE 03';
  Bomba.Tanque := 1;
  Bomba.Salvar;
  Cod1 := Bomba.Codigo;
  FreeAndNil(Bomba);
  //CADASTRA 2
  Bomba := TBomba.Create;
  Bomba.Descricao := 'TESTE 04';
  Bomba.Tanque := 1;
  Bomba.Salvar;
  Cod2 := Bomba.Codigo;
  FreeAndNil(Bomba);
  //EDITA 2
  Bomba := TBomba.Create;
  Bomba.Abrir(Cod2);
  Bomba.Descricao := Bomba.Descricao + ' EDITADO';
  Bomba.Tanque := 1;
  Bomba.Salvar;
  Tag := Bomba.Codigo;
  FreeAndNil(Bomba);
  //DELETA 1
  Bomba := TBomba.Create;
  Bomba.Abrir(Cod1);
  Bomba.Deletar;
  FreeAndNil(Bomba);


  //CADASTRA 1
  Abastecimento := TAbastecimento.Create;
  Abastecimento.Data := Date;
  Abastecimento.Hora := Time;
  Abastecimento.Bomba := 1;
  Abastecimento.Litros := 10;
  Abastecimento.Valor := 10;
  Abastecimento.Salvar;
  Cod1 := Abastecimento.Codigo;
  FreeAndNil(Abastecimento);
  //CADASTRA 2
  Abastecimento := TAbastecimento.Create;
  Abastecimento.Data := Date;
  Abastecimento.Hora := Time;
  Abastecimento.Bomba := 1;
  Abastecimento.Litros := 20;
  Abastecimento.Valor := 20;
  Abastecimento.Salvar;
  Cod2 := Abastecimento.Codigo;
  FreeAndNil(Abastecimento);
  //EDITA 2
  Abastecimento := TAbastecimento.Create;
  Abastecimento.Abrir(Cod2);
  Abastecimento.Data := Date;
  Abastecimento.Hora := Time;
  Abastecimento.Bomba := 1;
  Abastecimento.Litros := Abastecimento.Litros + 5;
  Abastecimento.Valor := Abastecimento.Valor + 5;
  Abastecimento.Salvar;
  Tag := Abastecimento.Codigo;
  FreeAndNil(Abastecimento);
  //DELETA 1
  Abastecimento := TAbastecimento.Create;
  Abastecimento.Abrir(Cod1);
  Abastecimento.Deletar;
  FreeAndNil(Abastecimento);


  AbastecimentoLista := TAbastecimento.Listar;
  BombaLista := TBomba.Listar;
  TanqueLista := TTanque.Listar;

  Exit;
  inherited;
  txt_Descricao.Show;
  txt_Descricao.SetFocus;
end;

procedure TFrm_CadTanques.txt_DescricaoKeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
begin
  inherited;
  if DM.EnterOrTab(Key) then txt_Imposto.SetFocus;
end;

procedure TFrm_CadTanques.txt_ImpostoKeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
begin
  inherited;
  if DM.EnterOrTab(Key) then
    if Btn_Salvar.Enabled then Btn_Salvar.SetFocus else SetFocusDefault;
end;

end.
